<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv='Content-Type' content='text/html; charset=utf-8'></meta>
    <link rel='stylesheet' type='text/css' href='statprofiler.css'></link>
    <title>StatProfilerHTML - /mnt/research/softwares/Lux/src/utils.jl</title>
  </head>
  <body>
    <div class='report-header'>
      <div class='backlink'>
        <a href='index.html'>Report index</a>
      </div>
      <div class='report-title'>
        StatProfilerHTML.jl report
      </div>
      <div class='generated-on'>
        Generated on Sat, 23 Apr 2022 11:46:57
      </div>
    </div>
    <table>
      <caption>File source code</caption>
      <thead>
        <tr>
          <th>Line</th>
          <th>Exclusive</th>
          <th>Inclusive</th>
          <th>Code</th>
        </tr>
      </thead>
      <tbody>
        <tr id='L1'>
          <td class='lineno'>1</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>replicate&#40;rng::AbstractRNG&#41; &#61; copy&#40;rng&#41;</span>
          </td>
        </tr>
        <tr id='L2'>
          <td class='lineno'>2</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>replicate&#40;rng::CUDA.RNG&#41; &#61; deepcopy&#40;rng&#41;</span>
          </td>
        </tr>
        <tr id='L3'>
          <td class='lineno'>3</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L4'>
          <td class='lineno'>4</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>zeros32&#40;rng::AbstractRNG, args...; kwargs...&#41; &#61; zeros32&#40;args...; kwargs...&#41;</span>
          </td>
        </tr>
        <tr id='L5'>
          <td class='lineno'>5</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>ones32&#40;rng::AbstractRNG, args...; kwargs...&#41; &#61; ones32&#40;args...; kwargs...&#41;</span>
          </td>
        </tr>
        <tr id='L6'>
          <td class='lineno'>6</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>Base.zeros&#40;rng::AbstractRNG, args...; kwargs...&#41; &#61; zeros&#40;args...; kwargs...&#41;</span>
          </td>
        </tr>
        <tr id='L7'>
          <td class='lineno'>7</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>Base.ones&#40;rng::AbstractRNG, args...; kwargs...&#41; &#61; ones&#40;args...; kwargs...&#41;</span>
          </td>
        </tr>
        <tr id='L8'>
          <td class='lineno'>8</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L9'>
          <td class='lineno'>9</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>@inline istraining&#40;&#41; &#61; false</span>
          </td>
        </tr>
        <tr id='L10'>
          <td class='lineno'>10</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>@inline istraining&#40;st::NamedTuple&#41;::Bool &#61; st.training</span>
          </td>
        </tr>
        <tr id='L11'>
          <td class='lineno'>11</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L12'>
          <td class='lineno'>12</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'>20 &#40;6 &#37;&#41;</td>
          <td>
            <div class='call-sites'>
              20 &#40;6 &#37;&#41;
              samples spent in _pullback
              <br />
              
              6 &#40;30 &#37;&#41; &#40;incl.&#41;
              when called from _pullback
              <a href='interface2.jl-2fbb0c9845b8b057a6fea4ddd8700cdbaf679e89.html#L0'>line 0</a>
              <br />
              
              8 &#40;40 &#37;&#41; &#40;incl.&#41;
              when called from Pullback
              <a href='interface2.jl-2fbb0c9845b8b057a6fea4ddd8700cdbaf679e89.html#L0'>line 0</a>
              <br />
              
              6 &#40;30 &#37;&#41; &#40;incl.&#41;
              when called from _pullback
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L12'>line 12</a>
              <br />
            </div>
            <div class='callees'>
              6 &#40;30 &#37;&#41;
              samples spent calling
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L12'>_pullback</a>
              <br />
              1 &#40;5 &#37;&#41;
              samples spent calling
              <a href='broadcast.jl-5109b1d22e090d7df082cbed75a8ab1355366772.html#L1297'>_pullback</a>
              <br />
              4 &#40;20 &#37;&#41;
              samples spent calling
              <a href='interface2.jl-2fbb0c9845b8b057a6fea4ddd8700cdbaf679e89.html#L42'>Pullback</a>
              <br />
              2 &#40;10 &#37;&#41;
              samples spent calling
              <a href='adjoint.jl-6063360fa27d5ff5d3d503b2677de2ef1a196dd1.html#L73'>#4075#back</a>
              <br />
              5 &#40;25 &#37;&#41;
              samples spent calling
              <a href='adjoint.jl-6063360fa27d5ff5d3d503b2677de2ef1a196dd1.html#L71'>_pullback</a>
              <br />
              2 &#40;10 &#37;&#41;
              samples spent calling
              <a href='broadcast.jl-5109b1d22e090d7df082cbed75a8ab1355366772.html#L1297'>Pullback</a>
              <br />
            </div>
            <span class='code'>@inline _norm&#40;x; dims&#61;Colon&#40;&#41;&#41; &#61; sqrt.&#40;sum&#40;abs2, x; dims&#61;dims&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L13'>
          <td class='lineno'>13</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L14'>
          <td class='lineno'>14</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'># Compute norm over all dimensions except &#96;except_dim&#96;</span>
          </td>
        </tr>
        <tr id='L15'>
          <td class='lineno'>15</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'>10 &#40;3 &#37;&#41;</td>
          <td>
            <div class='call-sites'>
              10 &#40;3 &#37;&#41;
              samples spent in _pullback
              <br />
              
              6 &#40;60 &#37;&#41; &#40;incl.&#41;
              when called from _pullback
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L16'>line 16</a>
              <br />
              
              4 &#40;40 &#37;&#41; &#40;incl.&#41;
              when called from Pullback
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L16'>line 16</a>
              <br />
            </div>
            <div class='callees'>
              6 &#40;60 &#37;&#41;
              samples spent calling
              <a href='interface2.jl-2fbb0c9845b8b057a6fea4ddd8700cdbaf679e89.html#L8'>_pullback</a>
              <br />
              4 &#40;40 &#37;&#41;
              samples spent calling
              <a href='interface2.jl-2fbb0c9845b8b057a6fea4ddd8700cdbaf679e89.html#L42'>Pullback</a>
              <br />
            </div>
            <span class='code'>@inline _norm_except&#40;x::AbstractArray&#123;T,N&#125;, except_dim&#41; where &#123;T,N&#125; &#61; _norm&#40;x; dims&#61;filter&#40;i -&gt; i &#33;&#61; except_dim, 1:N&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L16'>
          <td class='lineno'>16</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'>10 &#40;3 &#37;&#41;</td>
          <td>
            <div class='call-sites'>
              10 &#40;3 &#37;&#41;
              samples spent in _pullback
              <br />
              
              10 &#40;100 &#37;&#41; &#40;incl.&#41;
              when called from macro expansion
              <a href='normalize.jl-54faf954fade6429d77c6a327eb93ece08c068d5.html#L0'>line 0</a>
              <br />
            </div>
            <div class='callees'>
              6 &#40;60 &#37;&#41;
              samples spent calling
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L15'>_pullback</a>
              <br />
              4 &#40;40 &#37;&#41;
              samples spent calling
              <a href='utils.jl-b185be80b23403397564206d4253a5b13d7bc2bd.html#L15'>Pullback</a>
              <br />
            </div>
            <span class='code'>@inline _norm_except&#40;x::AbstractArray&#123;T,N&#125;&#41; where &#123;T,N&#125; &#61; _norm_except&#40;x, N&#41;</span>
          </td>
        </tr>
        <tr id='L17'>
          <td class='lineno'>17</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L18'>
          <td class='lineno'>18</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'># Handling ComponentArrays</span>
          </td>
        </tr>
        <tr id='L19'>
          <td class='lineno'>19</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>gpu&#40;c::ComponentArray&#41; &#61; ComponentArray&#40;gpu&#40;getdata&#40;c&#41;&#41;, getaxes&#40;c&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L20'>
          <td class='lineno'>20</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>cpu&#40;c::ComponentArray&#41; &#61; ComponentArray&#40;cpu&#40;getdata&#40;c&#41;&#41;, getaxes&#40;c&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L21'>
          <td class='lineno'>21</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L22'>
          <td class='lineno'>22</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>Base.zero&#40;c::ComponentArray&#123;T,N,&lt;:CuArray&#123;T&#125;&#125;&#41; where &#123;T,N&#125; &#61; ComponentArray&#40;zero&#40;getdata&#40;c&#41;&#41;, getaxes&#40;c&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L23'>
          <td class='lineno'>23</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L24'>
          <td class='lineno'>24</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>Base.vec&#40;c::ComponentArray&#123;T,N,&lt;:CuArray&#123;T&#125;&#125;&#41; where &#123;T,N&#125; &#61; getdata&#40;c&#41;</span>
          </td>
        </tr>
        <tr id='L25'>
          <td class='lineno'>25</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L26'>
          <td class='lineno'>26</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>Base.:-&#40;x::ComponentArray&#123;T,N,&lt;:CuArray&#123;T&#125;&#125;&#41; where &#123;T,N&#125; &#61; ComponentArray&#40;-getdata&#40;x&#41;, getaxes&#40;x&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L27'>
          <td class='lineno'>27</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L28'>
          <td class='lineno'>28</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function Base.similar&#40;c::ComponentArray&#123;T,N,&lt;:CuArray&#123;T&#125;&#125;, l::Vararg&#123;Union&#123;Integer,AbstractUnitRange&#125;&#125;&#41; where &#123;T,N&#125;</span>
          </td>
        </tr>
        <tr id='L29'>
          <td class='lineno'>29</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return similar&#40;getdata&#40;c&#41;, l&#41;</span>
          </td>
        </tr>
        <tr id='L30'>
          <td class='lineno'>30</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L31'>
          <td class='lineno'>31</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L32'>
          <td class='lineno'>32</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function Zygote.accum&#40;x::ComponentArray, ys::ComponentArray...&#41;</span>
          </td>
        </tr>
        <tr id='L33'>
          <td class='lineno'>33</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return ComponentArray&#40;Zygote.accum&#40;getdata&#40;x&#41;, getdata.&#40;ys&#41;...&#41;, getaxes&#40;x&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L34'>
          <td class='lineno'>34</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L35'>
          <td class='lineno'>35</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L36'>
          <td class='lineno'>36</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function Functors.functor&#40;::Type&#123;&lt;:ComponentArray&#125;, c&#41;</span>
          </td>
        </tr>
        <tr id='L37'>
          <td class='lineno'>37</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return NamedTuple&#123;propertynames&#40;c&#41;&#125;&#40;getproperty.&#40;&#40;c,&#41;, propertynames&#40;c&#41;&#41;&#41;, ComponentArray</span>
          </td>
        </tr>
        <tr id='L38'>
          <td class='lineno'>38</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L39'>
          <td class='lineno'>39</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L40'>
          <td class='lineno'>40</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function Optimisers.update&#33;&#40;st, ps::ComponentArray, gs::ComponentArray&#41;</span>
          </td>
        </tr>
        <tr id='L41'>
          <td class='lineno'>41</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    Optimisers.update&#33;&#40;st, NamedTuple&#40;ps&#41;, NamedTuple&#40;gs&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L42'>
          <td class='lineno'>42</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return st, ps</span>
          </td>
        </tr>
        <tr id='L43'>
          <td class='lineno'>43</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L44'>
          <td class='lineno'>44</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L45'>
          <td class='lineno'>45</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function ComponentArrays.make_carray_args&#40;nt::NamedTuple&#41;</span>
          </td>
        </tr>
        <tr id='L46'>
          <td class='lineno'>46</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    data, ax &#61; ComponentArrays.make_carray_args&#40;Vector, nt&#41;</span>
          </td>
        </tr>
        <tr id='L47'>
          <td class='lineno'>47</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    data &#61; length&#40;data&#41; &#61;&#61; 0 ? Float32&#91;&#93; : &#40;length&#40;data&#41;&#61;&#61;1 ? &#91;data&#91;1&#93;&#93; : reduce&#40;vcat, data&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L48'>
          <td class='lineno'>48</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return &#40;data, ax&#41;</span>
          </td>
        </tr>
        <tr id='L49'>
          <td class='lineno'>49</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L50'>
          <td class='lineno'>50</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L51'>
          <td class='lineno'>51</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>## For being able to print empty ComponentArrays</span>
          </td>
        </tr>
        <tr id='L52'>
          <td class='lineno'>52</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function ComponentArrays.last_index&#40;f::FlatAxis&#41;</span>
          </td>
        </tr>
        <tr id='L53'>
          <td class='lineno'>53</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    nt &#61; ComponentArrays.indexmap&#40;f&#41;</span>
          </td>
        </tr>
        <tr id='L54'>
          <td class='lineno'>54</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    length&#40;nt&#41; &#61;&#61; 0 &amp;&amp; return 0</span>
          </td>
        </tr>
        <tr id='L55'>
          <td class='lineno'>55</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return ComponentArrays.last_index&#40;last&#40;nt&#41;&#41;</span>
          </td>
        </tr>
        <tr id='L56'>
          <td class='lineno'>56</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L57'>
          <td class='lineno'>57</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L58'>
          <td class='lineno'>58</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>ComponentArrays.recursive_length&#40;nt::NamedTuple&#123;&#40;&#41;, Tuple&#123;&#125;&#125;&#41; &#61; 0</span>
          </td>
        </tr>
        <tr id='L59'>
          <td class='lineno'>59</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L60'>
          <td class='lineno'>60</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'># Return Nothing if field not present</span>
          </td>
        </tr>
        <tr id='L61'>
          <td class='lineno'>61</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>function safegetproperty&#40;x::Union&#123;ComponentArray,NamedTuple&#125;, k::Symbol&#41;</span>
          </td>
        </tr>
        <tr id='L62'>
          <td class='lineno'>62</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    k ∈ propertynames&#40;x&#41; &amp;&amp; return getproperty&#40;x, k&#41;</span>
          </td>
        </tr>
        <tr id='L63'>
          <td class='lineno'>63</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>    return nothing</span>
          </td>
        </tr>
        <tr id='L64'>
          <td class='lineno'>64</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>end</span>
          </td>
        </tr>
        <tr id='L65'>
          <td class='lineno'>65</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'></span>
          </td>
        </tr>
        <tr id='L66'>
          <td class='lineno'>66</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'># Getting typename</span>
          </td>
        </tr>
        <tr id='L67'>
          <td class='lineno'>67</td>
          <td class='tracecount excl'></td>
          <td class='tracecount incl'></td>
          <td>
            
            
            <span class='code'>get_typename&#40;::T&#41; where &#123;T&#125; &#61; Base.typename&#40;T&#41;.wrapper</span>
          </td>
        </tr>
      </tbody>
    </table>
  </body>
</html>

